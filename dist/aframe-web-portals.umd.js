!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){!function(e){function t(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return e[s].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};t.m=e,t.c=i,t.p="",t(0)}([function(e,t){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");var i={childList:!0,attributes:!0,subtree:!0};AFRAME.registerComponent("aabb-collider",{schema:{collideNonVisible:{default:!1},debug:{default:!1},enabled:{default:!0},interval:{default:80},objects:{default:""}},init:function(){this.centerDifferenceVec3=new THREE.Vector3,this.clearedIntersectedEls=[],this.closestIntersectedEl=null,this.boundingBox=new THREE.Box3,this.boxCenter=new THREE.Vector3,this.boxHelper=new THREE.BoxHelper,this.boxMax=new THREE.Vector3,this.boxMin=new THREE.Vector3,this.hitClosestClearEventDetail={},this.hitClosestEventDetail={},this.intersectedEls=[],this.objectEls=[],this.newIntersectedEls=[],this.prevCheckTime=void 0,this.previousIntersectedEls=[],this.setDirty=this.setDirty.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.hitStartEventDetail={intersectedEls:this.newIntersectedEls}},play:function(){this.observer.observe(this.el.sceneEl,i),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty)},remove:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},tick:function(e){var t,i,s,n,r=this.boundingBox,l=this.centerDifferenceVec3,o=this.clearedIntersectedEls,c=this.intersectedEls,a=this.el,h=this.newIntersectedEls,d=this.objectEls,b=this.prevCheckTime,u=this.previousIntersectedEls;if(this.data.enabled&&!(b&&e-b<this.data.interval)){for(this.prevCheckTime=e,this.dirty&&this.refreshObjects(),r.setFromObject(a.object3D),this.boxMin.copy(r.min),this.boxMax.copy(r.max),r.getCenter(this.boxCenter),this.data.debug&&(this.boxHelper.setFromObject(a.object3D),this.boxHelper.parent||a.sceneEl.object3D.add(this.boxHelper)),function(e,t){var i;for(e.length=0,i=0;i<t.length;i++)e[i]=t[i]}(u,c),c.length=0,n=0;n<d.length;n++)d[n]!==this.el&&(this.data.collideNonVisible||d[n].getAttribute("visible")?this.isIntersecting(d[n])&&c.push(d[n]):this.data.debug&&(t=d[n].object3D.boxHelper)&&(a.sceneEl.object3D.remove(t),d[n].object3D.boxHelper=null));for(h.length=0,n=0;n<c.length;n++)-1===u.indexOf(c[n])&&h.push(c[n]);for(o.length=0,n=0;n<u.length;n++)-1===c.indexOf(u[n])&&(u[n].hasAttribute("aabb-collider")||u[n].emit("hitend"),o.push(u[n]));for(n=0;n<h.length;n++)h[n]!==this.el&&(h[n].hasAttribute("aabb-collider")||h[n].emit("hitstart"));for(n=0;n<c.length;n++)c[n]!==this.el&&(l.copy(c[n].object3D.boundingBoxCenter).sub(this.boxCenter),(void 0===i||l.length()<i)&&(i=l.length(),s=c[n]));!c.length&&this.closestIntersectedEl?(this.hitClosestClearEventDetail.el=this.closestIntersectedEl,this.closestIntersectedEl.emit("hitclosestclear"),this.closestIntersectedEl=null,a.emit("hitclosestclear",this.hitClosestClearEventDetail)):s!==this.closestIntersectedEl&&(this.closestIntersectedEl&&(this.hitClosestClearEventDetail.el=this.closestIntersectedEl,this.closestIntersectedEl.emit("hitclosestclear",this.hitClosestClearEventDetail)),s&&(s.emit("hitclosest"),this.closestIntersectedEl=s,this.hitClosestEventDetail.el=s,a.emit("hitclosest",this.hitClosestEventDetail))),o.length&&a.emit("hitend"),h.length&&a.emit("hitstart",this.hitStartEventDetail)}},isIntersecting:function(){var e=new THREE.Box3;return function(t){var i,s;return e.setFromObject(t.object3D),this.data.debug&&(t.object3D.boxHelper||(t.object3D.boxHelper=new THREE.BoxHelper(t.object3D,new THREE.Color(Math.random(),Math.random(),Math.random())),t.sceneEl.object3D.add(t.object3D.boxHelper)),t.object3D.boxHelper.setFromObject(t.object3D)),i=e.min,s=e.max,t.object3D.boundingBoxCenter=t.object3D.boundingBoxCenter||new THREE.Vector3,e.getCenter(t.object3D.boundingBoxCenter),this.boxMin.x<=s.x&&this.boxMax.x>=i.x&&this.boxMin.y<=s.y&&this.boxMax.y>=i.y&&this.boxMin.z<=s.z&&this.boxMax.z>=i.z}}(),setDirty:function(){this.dirty=!0},refreshObjects:function(){var e=this.data;this.objectEls=e.objects?this.el.sceneEl.querySelectorAll(e.objects):this.el.sceneEl.children,this.dirty=!1}})}]),AFRAME.registerComponent("web-portal",{schema:{url:{default:""},iframe:{default:""},player:{default:""},text:{default:""},portalFrame:{default:!0}},init:function(){var e=this.el,t=this.data,i=e.sceneEl;if(e.setAttribute("geometry",{primitive:"plane",width:1.5,height:2.4}),e.setAttribute("material",{color:"#faf"}),""!==t.player){var s;document.querySelector(t.player),e.setAttribute("aabb-collider",{objects:t.player}),""!==t.iframe?s=document.querySelector(t.iframe):((s=document.createElement("iframe")).style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.overflow="none",s.style.zIndex=-10,s.style.display="none",document.body.appendChild(s)),s.src=t.url;var n=document.createElement("a-text");if(n.setAttribute("value",t.text),n.setAttribute("position","0 1.75 .4"),n.setAttribute("align","center"),e.appendChild(n),t.titleEl=n,1==t.portalFrame){var r=document.createElement("a-box");r.setAttribute("position",".75 0 .24"),r.setAttribute("scale",".25 2.6 .5"),e.appendChild(r);var l=document.createElement("a-box");l.setAttribute("position","-.75 0 .24"),l.setAttribute("scale",".25 2.6 .5"),e.appendChild(l);var o=document.createElement("a-box");o.setAttribute("position","0 1.2 .24"),o.setAttribute("scale","1.7 .25 .5"),e.appendChild(o);var c=document.createElement("a-box");c.setAttribute("position","0 0 -.06"),c.setAttribute("scale","1.6 2.5 .1"),e.appendChild(c)}e.addEventListener("hitstart",function(){console.log("hit"),i.style.zIndex=-10,i.style.display="none",s.style.zIndex=10,s.style.display="block",document.exitPointerLock()})}else console.error("aframe-web-portal: player not defined")},update:function(){var e=this.data;e.titleEl.setAttribute("value",e.text)}})});
//# sourceMappingURL=aframe-web-portals.umd.js.map
