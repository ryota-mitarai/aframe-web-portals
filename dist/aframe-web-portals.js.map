{"version":3,"file":"aframe-web-portals.js","sources":["../src/lib/aframe-aabb-collider-component.min.js","../src/webportal.js"],"sourcesContent":["!function(e){function t(i){if(s[i])return s[i].exports;var n=s[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var s={};return t.m=e,t.c=s,t.p=\"\",t(0)}([function(e,t){function s(e,t){var s;for(e.length=0,s=0;s<t.length;s++)e[s]=t[s]}if(\"undefined\"==typeof AFRAME)throw new Error(\"Component attempted to register before AFRAME was available.\");var i={childList:!0,attributes:!0,subtree:!0};AFRAME.registerComponent(\"aabb-collider\",{schema:{collideNonVisible:{default:!1},debug:{default:!1},enabled:{default:!0},interval:{default:80},objects:{default:\"\"}},init:function(){this.centerDifferenceVec3=new THREE.Vector3,this.clearedIntersectedEls=[],this.closestIntersectedEl=null,this.boundingBox=new THREE.Box3,this.boxCenter=new THREE.Vector3,this.boxHelper=new THREE.BoxHelper,this.boxMax=new THREE.Vector3,this.boxMin=new THREE.Vector3,this.hitClosestClearEventDetail={},this.hitClosestEventDetail={},this.intersectedEls=[],this.objectEls=[],this.newIntersectedEls=[],this.prevCheckTime=void 0,this.previousIntersectedEls=[],this.setDirty=this.setDirty.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.hitStartEventDetail={intersectedEls:this.newIntersectedEls}},play:function(){this.observer.observe(this.el.sceneEl,i),this.el.sceneEl.addEventListener(\"object3dset\",this.setDirty),this.el.sceneEl.addEventListener(\"object3dremove\",this.setDirty)},remove:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener(\"object3dset\",this.setDirty),this.el.sceneEl.removeEventListener(\"object3dremove\",this.setDirty)},tick:function(e){var t,i,n,r,o=this.boundingBox,l=this.centerDifferenceVec3,h=this.clearedIntersectedEls,c=this.intersectedEls,a=this.el,b=this.newIntersectedEls,d=this.objectEls,E=this.prevCheckTime,x=this.previousIntersectedEls;if(this.data.enabled&&!(E&&e-E<this.data.interval)){for(this.prevCheckTime=e,this.dirty&&this.refreshObjects(),o.setFromObject(a.object3D),this.boxMin.copy(o.min),this.boxMax.copy(o.max),o.getCenter(this.boxCenter),this.data.debug&&(this.boxHelper.setFromObject(a.object3D),this.boxHelper.parent||a.sceneEl.object3D.add(this.boxHelper)),s(x,c),c.length=0,r=0;r<d.length;r++)d[r]!==this.el&&(this.data.collideNonVisible||d[r].getAttribute(\"visible\")?this.isIntersecting(d[r])&&c.push(d[r]):this.data.debug&&(t=d[r].object3D.boxHelper,t&&(a.sceneEl.object3D.remove(t),d[r].object3D.boxHelper=null)));for(b.length=0,r=0;r<c.length;r++)x.indexOf(c[r])===-1&&b.push(c[r]);for(h.length=0,r=0;r<x.length;r++)c.indexOf(x[r])===-1&&(x[r].hasAttribute(\"aabb-collider\")||x[r].emit(\"hitend\"),h.push(x[r]));for(r=0;r<b.length;r++)b[r]!==this.el&&(b[r].hasAttribute(\"aabb-collider\")||b[r].emit(\"hitstart\"));for(r=0;r<c.length;r++)c[r]!==this.el&&(l.copy(c[r].object3D.boundingBoxCenter).sub(this.boxCenter),(void 0===i||l.length()<i)&&(i=l.length(),n=c[r]));!c.length&&this.closestIntersectedEl?(this.hitClosestClearEventDetail.el=this.closestIntersectedEl,this.closestIntersectedEl.emit(\"hitclosestclear\"),this.closestIntersectedEl=null,a.emit(\"hitclosestclear\",this.hitClosestClearEventDetail)):n!==this.closestIntersectedEl&&(this.closestIntersectedEl&&(this.hitClosestClearEventDetail.el=this.closestIntersectedEl,this.closestIntersectedEl.emit(\"hitclosestclear\",this.hitClosestClearEventDetail)),n&&(n.emit(\"hitclosest\"),this.closestIntersectedEl=n,this.hitClosestEventDetail.el=n,a.emit(\"hitclosest\",this.hitClosestEventDetail))),h.length&&a.emit(\"hitend\"),b.length&&a.emit(\"hitstart\",this.hitStartEventDetail)}},isIntersecting:function(){var e=new THREE.Box3;return function(t){var s,i;return e.setFromObject(t.object3D),this.data.debug&&(t.object3D.boxHelper||(t.object3D.boxHelper=new THREE.BoxHelper(t.object3D,new THREE.Color(Math.random(),Math.random(),Math.random())),t.sceneEl.object3D.add(t.object3D.boxHelper)),t.object3D.boxHelper.setFromObject(t.object3D)),s=e.min,i=e.max,t.object3D.boundingBoxCenter=t.object3D.boundingBoxCenter||new THREE.Vector3,e.getCenter(t.object3D.boundingBoxCenter),this.boxMin.x<=i.x&&this.boxMax.x>=s.x&&this.boxMin.y<=i.y&&this.boxMax.y>=s.y&&this.boxMin.z<=i.z&&this.boxMax.z>=s.z}}(),setDirty:function(){this.dirty=!0},refreshObjects:function(){var e=this.data;this.objectEls=e.objects?this.el.sceneEl.querySelectorAll(e.objects):this.el.sceneEl.children,this.dirty=!1}})}]);","import './lib/aframe-aabb-collider-component.min.js';\r\n\r\nAFRAME.registerComponent('web-portal', {\r\n  schema: {\r\n    url: { default: '' },\r\n    iframe: { default: '' },\r\n    player: { default: '' },\r\n    text: { default: '' },\r\n    portalFrame: { default: true },\r\n  },\r\n\r\n  init: function () {\r\n    const el = this.el;\r\n    const data = this.data;\r\n    const scene = el.sceneEl;\r\n\r\n    el.setAttribute('geometry', { primitive: 'plane', width: 1.5, height: 2.4 });\r\n    el.setAttribute('material', { color: '#faf' });\r\n\r\n    var player;\r\n    if (data.player !== '') {\r\n      player = document.querySelector(data.player);\r\n      el.setAttribute('aabb-collider', { objects: data.player });\r\n    } else {\r\n      console.error('aframe-web-portal: player not defined');\r\n      return;\r\n      //TODO: automatically use the scene camera as the player\r\n      //player = scene.camera;\r\n    }\r\n\r\n    var iframe;\r\n    if (data.iframe !== '') {\r\n      iframe = document.querySelector(data.iframe);\r\n    } else {\r\n      iframe = document.createElement('iframe');\r\n      iframe.style.position = 'fixed';\r\n      iframe.style.top = '0';\r\n      iframe.style.left = '0';\r\n      iframe.style.width = '100%';\r\n      iframe.style.height = '100%';\r\n      iframe.style.overflow = 'none';\r\n      iframe.style.zIndex = -10;\r\n      iframe.style.display = 'none';\r\n      document.body.appendChild(iframe);\r\n    }\r\n    iframe.src = data.url;\r\n\r\n    const title = document.createElement('a-text');\r\n    title.setAttribute('value', data.text);\r\n    title.setAttribute('position', '0 1.75 .4');\r\n    title.setAttribute('align', 'center');\r\n    el.appendChild(title);\r\n    data.titleEl = title;\r\n\r\n    if (data.portalFrame == true) {\r\n      const box1 = document.createElement('a-box');\r\n      box1.setAttribute('position', '.75 0 .24');\r\n      box1.setAttribute('scale', '.25 2.6 .5');\r\n      el.appendChild(box1);\r\n\r\n      const box2 = document.createElement('a-box');\r\n      box2.setAttribute('position', '-.75 0 .24');\r\n      box2.setAttribute('scale', '.25 2.6 .5');\r\n      el.appendChild(box2);\r\n\r\n      const box3 = document.createElement('a-box');\r\n      box3.setAttribute('position', '0 1.2 .24');\r\n      box3.setAttribute('scale', '1.7 .25 .5');\r\n      el.appendChild(box3);\r\n\r\n      const box4 = document.createElement('a-box');\r\n      box4.setAttribute('position', '0 0 -.06');\r\n      box4.setAttribute('scale', '1.6 2.5 .1');\r\n      el.appendChild(box4);\r\n    }\r\n\r\n    el.addEventListener('hitstart', function () {\r\n      console.log('hit');\r\n\r\n      scene.style.zIndex = -10;\r\n      scene.style.display = 'none';\r\n      iframe.style.zIndex = 10;\r\n      iframe.style.display = 'block';\r\n\r\n      document.exitPointerLock();\r\n    });\r\n  },\r\n\r\n  update: function () {\r\n    const el = this.el;\r\n    const data = this.data;\r\n\r\n    data.titleEl.setAttribute('value', data.text);\r\n  },\r\n});\r\n"],"names":["e","t","i","s","exports","n","id","loaded","call","m","c","p","AFRAME","Error","childList","attributes","subtree","registerComponent","schema","collideNonVisible","default","debug","enabled","interval","objects","init","this","centerDifferenceVec3","THREE","Vector3","clearedIntersectedEls","closestIntersectedEl","boundingBox","Box3","boxCenter","boxHelper","BoxHelper","boxMax","boxMin","hitClosestClearEventDetail","hitClosestEventDetail","intersectedEls","objectEls","newIntersectedEls","prevCheckTime","previousIntersectedEls","setDirty","bind","observer","MutationObserver","dirty","hitStartEventDetail","play","observe","el","sceneEl","addEventListener","remove","disconnect","removeEventListener","tick","r","o","l","h","a","b","d","E","x","data","refreshObjects","setFromObject","object3D","copy","min","max","getCenter","parent","add","length","getAttribute","isIntersecting","push","indexOf","hasAttribute","emit","boundingBoxCenter","sub","Color","Math","random","y","z","querySelectorAll","children","url","iframe","player","text","portalFrame","scene","setAttribute","primitive","width","height","color","document","querySelector","createElement","style","position","top","left","overflow","zIndex","display","body","appendChild","src","title","titleEl","box1","box2","box3","box4","console","log","exitPointerLock","error","update"],"mappings":"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"}